@page "/login"
@using PRIORI_SERVICES_WEB.Data.API
@inject IJSRuntime JSInterop
@inject NavigationManager NavigationManager

<style>
    ::-webkit-scrollbar {
        display: none;
    }

    body {
        background-image: linear-gradient(75deg, rgb(211, 35, 218), rgb(114, 0, 167));
    }
</style>


<NavMenu nav_classes="sticky-top" nav_style="" />

<section class="bg-transparent py-5 container-fluid row d-flex flex-row justify-content-center align-items-center">
    <div class="col-md-9 col-lg-6 col-xl-5">
        <img src="assets/inv1Img.png" width="85%" class="img-fluid" alt="Sample image">
    </div>
    <div class="col-md-8 col-lg-6 col-xl-4 offset-xl-1">
        <form>
            <div class="d-flex m-3 flex-row align-items-center justify-content-center justify-content-lg-start">
                <p class="lead fw-normal mb-0 me-3 ">
                    <i class="bi bi-lock"></i>
                    Login
                </p>
            </div>
            <!-- Email input -->
            <div class="form-outline mb-4">
                <label class="form-label" for="form3Example3">E-mail</label>
                <input type="email" id="emailLogin"
                    class="form-control form-control-lg text-white bg-transparent" @bind="emailUser" />
            </div>
            <!-- Password input -->
            <div class="form-outline mb-3">
                <label class="form-label" for="form3Example4">Senha</label>
                <input type="password" id="senhaLogin"
                    class="form-control form-control-lg bg-transparent text-white" @bind="senhaUser" />
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <!-- Checkbox -->
                <div class="form-check mb-0">
                    <input class="form-check-input me-2" type="checkbox" value="" id="permanecerConectado" />
                    <label class="form-check-label" for="form2Example3">
                        Permanecer conectado
                    </label>
                </div>
                <a href="#!" class="text-light">Esqueceu sua senha?</a>
            </div>
            <div class="text-center text-lg-start mt-4 pt-2">
                <button type="button" class="btn btn-outline-light text-white px-5 py-3 my-3"
                @onclick="(e) => {LoginUser();}">Acessar</button>
                <p class="small fw-bold mt-2 pt-1 mb-0">NÃ£o possui cadastro?
                    <a href="/cadastro" class="link-danger">Registre-se</a>
                </p>
            </div>
            <h5 class="fw-bold text-error d-@display_errorlabel">Falha ao fazer login</h5>
        </form>
    </div>
</section>

@code {
    private string display_errorlabel { get; set; } = "none";
    private string senhaUser { get; set; } = string.Empty;
    private string emailUser { get; set; } = string.Empty;

    public void LoginUser()
    {
        try
        {
            var t = LoginUserAsync(emailUser, senhaUser);
            t.RunSynchronously();
        }
        catch (Exception){}
    }

    public async Task LoginUserAsync(string email, string senha)
    {
        var response = await APIHandler.PostApiRequestAsync(new Dictionary<string, string> {
{"email", emailUser},
{"senha", senhaUser}
}, "api/Auth/Cliente/login");
        if (response.IsSuccessStatusCode) {
            display_errorlabel = "none";
            await JSInterop.InvokeVoidAsync(
                "localStorage.setItem", 
                "app_token", 
                await response.Content.ReadAsStringAsync()
            );
            NavigationManager.NavigateTo("/");
        } else {
            display_errorlabel = "block";
        }
    }
}
